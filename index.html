<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>ArtsyHub</title>
    <script src = "https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script type ="text/javascript">
    (function($){
      $(document).ready(function(){

        api_key = 'qup7qb9q3l9j9cqzrsw0d0gm';
        $('button').click(function(){
          $('ul').empty();
          $('h4').empty();
          $('input').empty();
          let shops = [];
          tag = $("[id='tag']").val();
          $.ajax({
            url: 'https://openapi.etsy.com/v2/listings/active.js?tags=' + tag + '&api_key=' + api_key,
            dataType: 'jsonp',
            success: function(data){
              if(data.ok && data.count > 0)
              {
                let results = [data.results[0].listing_id, data.results[1].listing_id,
                                 data.results[2].listing_id, data.results[3].listing_id,
                                 data.results[4].listing_id, data.results[5].listing_id];
                $.each(results, function(i, item){
                  $.ajax({
                    url: 'https://openapi.etsy.com/v2/shops/listing/' + item + '.js?api_key=' + api_key,
                    dataType: 'jsonp',
                    success: function(data){
                      if(data.ok && data.count > 0) {
                        $.each(data.results, function(j, item){
                          if(item && item.shop_name){
                            let shop = item.shop_name;
                            if($.inArray(shop, shops) === -1)
                            {
                              shops.push(shop);
                              $('ul').append("<li>https://www.etsy.com/shop/"+shop+"</li>");
                            }
                        }
                    })
                  }
                  }
                })
              });
              $('.inner').prepend("<h4>Here's a list of Etsy sellers to look at!</h4>");
            }
          }
        })
      });
    });
    })(jQuery);
    </script>
  </head>
  <body onload>
    <h1>ArtsyHub</h1>
    <h3>Type in your favorite artist to get a list of sellers on Etsy to buy their merch from!</h2>
    <div class = "container">
      <input id = "tag"></input>
      <button id="button">Enter your favorite artist</button>
      <div class = "inner">
        <ul></ul>
      </div>
    </div>
  </body>
</html>
